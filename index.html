<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LibPro Cloud v3.6 - Seboterapia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .tab-content { display: none; animation: fadeIn 0.2s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Estilo dos BotÃµes do Topo */
        .active-tab { color: #fff !important; background: #4f46e5 !important; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .nav-btn { transition: all 0.2s; white-space: nowrap; }
        
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        
        /* Ajuste fino para inputs no mobile */
        input, select, textarea { font-size: 16px !important; } /* Evita zoom no iOS */
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <header class="glass sticky top-0 z-40 border-b border-slate-200 shadow-sm">
        <div class="px-4 py-3 flex justify-between items-center max-w-2xl mx-auto">
            <div>
                <h1 class="text-lg font-extrabold tracking-tight text-indigo-600">LibPro</h1>
                <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest leading-none">Seboterapia v3.6</p>
            </div>
            <div id="spinner" class="hidden animate-spin w-5 h-5 border-2 border-indigo-600 border-t-transparent rounded-full"></div>
        </div>
        
        <nav class="flex gap-1 px-4 pb-3 overflow-x-auto no-scrollbar max-w-2xl mx-auto">
            <button onclick="switchTab('cadastro', this)" class="nav-btn active-tab flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold text-slate-500 bg-slate-100">
                <span>Novo</span>
            </button>
            <button onclick="switchTab('acervo', this)" class="nav-btn flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold text-slate-500 bg-slate-100">
                <span>Acervo</span>
            </button>
            <button onclick="switchTab('relatorios', this)" class="nav-btn flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold text-slate-500 bg-slate-100">
                <span>RelatÃ³rios</span>
            </button>
            <button onclick="switchTab('config', this)" class="nav-btn flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold text-slate-500 bg-slate-100">
                <span>Ajustes</span>
            </button>
        </nav>
    </header>

    <main class="max-w-2xl mx-auto px-4 pt-4 pb-10">
        
        <section id="cadastro" class="tab-content active space-y-4">
            <div class="flex gap-2">
                <input type="text" id="buscaManual" placeholder="ISBN..." class="flex-1 bg-white px-4 py-3 rounded-2xl border border-slate-200 outline-none shadow-sm text-sm">
                
                <button type="button" onclick="window.buscarLivro()" class="bg-indigo-600 text-white p-3.5 rounded-2xl shadow-lg active:scale-95 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </button>
                
                <button onclick="abrirScanner()" class="bg-slate-800 text-white p-3.5 rounded-2xl shadow-lg active:scale-95 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" /></svg>
                </button>
            </div>

            <form id="formLivro" class="bg-white p-5 rounded-3xl shadow-sm border border-slate-200 space-y-5">
                <input type="hidden" id="edit_id">
                
                <div class="flex gap-4">
                    <div class="relative flex-shrink-0">
                        <div class="w-24 h-32 bg-slate-50 rounded-xl overflow-hidden flex flex-col items-center justify-center border-2 border-dashed border-slate-200">
                            <img id="preview" src="" class="w-full h-full object-cover z-10 hidden">
                            <div id="placeholder-icon" class="text-slate-300"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg></div>
                        </div>
                        <button type="button" onclick="abrirCameraDireta()" class="absolute -bottom-1 -right-1 bg-indigo-600 text-white p-2 rounded-full shadow-lg z-20"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /></svg></button>
                    </div>

                    <div class="flex-1 space-y-3 min-w-0">
                        <div>
                            <label class="text-[9px] font-black text-slate-400 uppercase">TÃ­tulo</label>
                            <input type="text" id="titulo" required class="w-full text-base font-bold border-b border-slate-100 py-0.5 outline-none focus:border-indigo-500 bg-transparent">
                        </div>
                        <div>
                            <label class="text-[9px] font-black text-slate-400 uppercase">Autor</label>
                            <input type="text" id="autor" class="w-full text-sm border-b border-slate-100 py-0.5 outline-none focus:border-indigo-500 bg-transparent">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-[9px] font-black text-slate-400 uppercase">ISBN</label>
                                <input type="text" id="isbn" class="w-full text-xs border-b border-slate-100 py-0.5 outline-none">
                            </div>
                            <div>
                                <label class="text-[9px] font-black text-slate-400 uppercase">PÃ¡ginas</label>
                                <input type="number" id="paginas" class="w-full text-xs border-b border-slate-100 py-0.5 outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="col-span-2">
                        <label class="text-[9px] font-black text-slate-400 uppercase">Editora</label>
                        <input type="text" id="editora" class="w-full text-xs border-b border-slate-100 py-1 outline-none">
                    </div>
                    <div>
                        <label class="text-[9px] font-black text-indigo-600 uppercase">SKU</label>
                        <div class="flex gap-1 items-center border-b border-indigo-100">
                            <input type="text" id="sku" class="flex-1 text-xs py-1 outline-none font-bold text-indigo-700 bg-transparent">
                            <button type="button" onclick="window.gerarSkuAuto()" class="text-indigo-400"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></button>
                        </div>
                    </div>
                    <div>
                        <label class="text-[9px] font-black text-slate-400 uppercase">GÃªnero</label>
                        <select id="select_categoria" class="w-full text-xs font-bold py-1.5 bg-slate-50 rounded-lg outline-none"></select>
                    </div>
                    <div class="col-span-2">
                        <label class="text-[9px] font-black text-slate-400 uppercase">ConservaÃ§Ã£o</label>
                        <select id="select_estado" class="w-full text-xs font-bold py-1.5 bg-slate-50 rounded-lg outline-none"></select>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button type="button" onclick="window.limparCampos()" class="p-3 bg-slate-100 text-slate-500 rounded-xl"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg></button>
                    <input type="hidden" id="url_foto">
                    <button type="submit" id="btnSalvar" class="flex-1 bg-indigo-600 text-white py-3 rounded-xl font-extrabold text-xs shadow-lg uppercase tracking-widest">SALVAR NO ACERVO</button>
                </div>
            </form>
        </section>

        <section id="acervo" class="tab-content space-y-3">
            <div class="flex justify-between items-center bg-white p-3 rounded-2xl border border-slate-200">
                <h2 class="text-sm font-black text-slate-800 uppercase">CatÃ¡logo</h2>
                <span id="contador" class="text-[10px] font-bold bg-indigo-100 px-2 py-0.5 rounded-full text-indigo-600">0 ITENS</span>
            </div>
            <input type="text" id="filtro" onkeyup="window.filtrarAcervoLocal()" placeholder="Pesquisar tÃ­tulo, autor ou SKU..." class="w-full bg-white px-4 py-3 rounded-2xl border border-slate-200 outline-none text-sm shadow-sm">
            
            <div id="lista_acervo" class="flex flex-col gap-2">
                </div>
        </section>

        <section id="relatorios" class="tab-content space-y-4">
            <h2 class="text-sm font-black text-slate-800 uppercase">Exportar Dados</h2>
            <div class="bg-white p-5 rounded-3xl border border-slate-200 space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <input type="date" id="rel_data_inicio" class="w-full bg-slate-50 p-2 rounded-xl text-xs border-none">
                    <input type="date" id="rel_data_fim" class="w-full bg-slate-50 p-2 rounded-xl text-xs border-none">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="window.gerarRelatorio('excel')" class="bg-emerald-600 text-white p-3 rounded-xl font-bold text-[10px] uppercase shadow-md">Excel</button>
                    <button onclick="window.gerarRelatorio('pdf')" class="bg-rose-600 text-white p-3 rounded-xl font-bold text-[10px] uppercase shadow-md">PDF</button>
                </div>
            </div>
            
            <div id="dashboard" class="grid grid-cols-2 gap-3">
                <div class="bg-indigo-600 p-4 rounded-2xl text-white">
                    <p class="text-[9px] font-bold uppercase opacity-80">Total</p>
                    <h3 id="dash_total" class="text-2xl font-black">0</h3>
                </div>
                <div class="bg-white p-4 rounded-2xl border border-slate-200">
                    <p class="text-[9px] font-black text-slate-400 uppercase">Categorias</p>
                    <h3 id="dash_cats" class="text-2xl font-black text-indigo-600">0</h3>
                </div>
            </div>
        </section>

        <section id="config" class="tab-content space-y-4">
            <h2 class="text-sm font-black text-slate-800 uppercase tracking-tighter">Ajustes</h2>
            <div class="bg-white p-5 rounded-3xl border border-slate-200 space-y-3">
                <h3 class="text-[10px] font-black text-indigo-600 uppercase">Categorias</h3>
                <div class="flex gap-2">
                    <input type="text" id="input_cat" class="flex-1 bg-slate-50 p-2 rounded-xl text-sm border-none">
                    <button onclick="window.adicionarAuxCloud('categorias')" class="bg-indigo-600 text-white px-4 rounded-xl font-bold">+</button>
                </div>
                <div id="list_cat" class="flex flex-wrap gap-1"></div>
            </div>
        </section>
    </main>

    <div id="modalScanner" class="hidden fixed inset-0 z-[60] bg-slate-900 flex flex-col">
        <div class="flex justify-between items-center text-white p-6">
            <h3 class="font-bold uppercase tracking-widest text-xs">Aponte para o CÃ³digo de Barras</h3>
            <button onclick="fecharScanner()" class="p-2 bg-white/10 rounded-full text-xl">âœ•</button>
        </div>
        <div id="reader" class="w-full flex-1"></div>
        <div class="p-8 text-center text-white/50 text-[10px] uppercase font-bold tracking-widest bg-slate-900">
            Mantenha o cÃ³digo centralizado e estÃ¡vel
        </div>
    </div>

    <div id="modalCamera" class="hidden fixed inset-0 z-[60] bg-black flex flex-col">
        <video id="videoElement" class="w-full h-full object-cover" autoplay playsinline></video>
        <div class="absolute bottom-10 left-0 right-0 flex justify-center gap-10">
            <button onclick="fecharCamera()" class="bg-white/10 p-4 rounded-full text-white backdrop-blur-md">âœ•</button>
            <button onclick="capturarFoto()" class="bg-white p-5 rounded-full text-black shadow-xl">ðŸ“¸</button>
        </div>
    </div>
    
    <canvas id="canvasElement" class="hidden"></canvas>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, query, orderBy, onSnapshot, setDoc, getDoc, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

		const firebaseConfig = {
		  apiKey: "SEU_API_KEY",
		  authDomain: "SEU_DOMAIN",
		  projectId: "SEU_PROJECT_ID",
		  storageBucket: "SEU_STORAGE",
		  messagingSenderId: "SEU_SENDER",
		  appId: "SEU_APP_ID"
		};

        const app = initializeApp(firebaseConfig);
        const db_cloud = getFirestore(app);
        const storage = getStorage(app);

        let acervoCache = [];
        let auxiliares = { categorias: [], estados: [] };

        window.gerarSkuAuto = () => {
            const ag = new Date();
            const sku = `L${ag.toISOString().slice(2, 10).replace(/-/g, '')}-${ag.getHours().toString().padStart(2, '0')}${ag.getMinutes().toString().padStart(2, '0')}`;
            document.getElementById('sku').value = sku;
        };

        window.buscarLivro = async (val = null) => {
            const t = val || document.getElementById('buscaManual').value;
            if(!t) return;
            document.getElementById('spinner').classList.remove('hidden');
            try {
                const res = await fetch(`https://brasilapi.com.br/api/isbn/v1/${t}`);
                if(res.ok) {
                    const d = await res.json();
                    document.getElementById('titulo').value = d.title || '';
                    document.getElementById('autor').value = d.authors?.join(', ') || '';
                    document.getElementById('editora').value = d.publisher || '';
                    document.getElementById('paginas').value = d.page_count || '';
                    document.getElementById('isbn').value = d.isbn || t;
                    window.setCapa(`https://covers.openlibrary.org/b/isbn/${t}-L.jpg`);
                }
            } catch(e) { console.error(e); }
            finally { document.getElementById('spinner').classList.add('hidden'); }
        };

        window.setCapa = (u) => {
            const i = document.getElementById('preview'), ph = document.getElementById('placeholder-icon'), inp = document.getElementById('url_foto');
            i.src = u; i.classList.remove('hidden'); ph.classList.add('hidden'); inp.value = u;
        };

        onSnapshot(query(collection(db_cloud, "livros"), orderBy("timestamp", "desc")), (snap) => {
            acervoCache = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            renderizarUI(acervoCache);
            atualizarDashboard();
        });

        function atualizarDashboard() {
            document.getElementById('dash_total').innerText = acervoCache.length;
            const ct = [...new Set(acervoCache.map(l => l.categoria))].filter(c => c);
            document.getElementById('dash_cats').innerText = ct.length;
        }

        document.getElementById('formLivro').onsubmit = async (e) => {
            e.preventDefault(); 
            document.getElementById('spinner').classList.remove('hidden');
            try {
                const idEd = document.getElementById('edit_id').value, fotoR = document.getElementById('url_foto').value;
                let urlF = fotoR;
                if(fotoR.startsWith('data:image')) {
                    const sRef = ref(storage, `capas/${Date.now()}.jpg`);
                    await uploadString(sRef, fotoR, 'data_url'); urlF = await getDownloadURL(sRef);
                }
                const d = {
                    titulo: document.getElementById('titulo').value, autor: document.getElementById('autor').value,
                    isbn: document.getElementById('isbn').value, paginas: document.getElementById('paginas').value,
                    editora: document.getElementById('editora').value, sku: document.getElementById('sku').value,
                    categoria: document.getElementById('select_categoria').value, estado: document.getElementById('select_estado').value,
                    observacao: document.getElementById('observacao').value || "", foto: urlF, timestamp: Timestamp.now()
                };
                if(idEd) await updateDoc(doc(db_cloud, "livros", idEd), d);
                else await addDoc(collection(db_cloud, "livros"), d);
                window.limparCampos(); 
                alert("Sincronizado!");
            } catch(err) { alert("Erro ao salvar."); }
            finally { document.getElementById('spinner').classList.add('hidden'); }
        };

        window.limparCampos = () => {
            document.getElementById('formLivro').reset();
            document.getElementById('edit_id').value = ''; 
            document.getElementById('preview').classList.add('hidden');
            document.getElementById('placeholder-icon').classList.remove('hidden'); 
            document.getElementById('url_foto').value = '';
            document.getElementById('btnSalvar').innerText = "SALVAR NO ACERVO";
        };

        window.editarLivro = (id) => {
            const l = acervoCache.find(x => x.id === id); 
            switchTab('cadastro', document.querySelector('nav button:first-child'));
            document.getElementById('edit_id').value = l.id; 
            document.getElementById('titulo').value = l.titulo;
            document.getElementById('autor').value = l.autor; 
            document.getElementById('isbn').value = l.isbn;
            document.getElementById('editora').value = l.editora; 
            document.getElementById('sku').value = l.sku; 
            document.getElementById('select_categoria').value = l.categoria;
            document.getElementById('select_estado').value = l.estado; 
            document.getElementById('btnSalvar').innerText = "ATUALIZAR"; 
            if(l.foto) window.setCapa(l.foto);
        };

        window.removerLivro = async (id) => { if(confirm("Remover permanentemente?")) await deleteDoc(doc(db_cloud, "livros", id)); };

        async function carregarAuxiliares() {
            const docS = await getDoc(doc(db_cloud, "config", "auxiliares"));
            auxiliares = docS.exists() ? docS.data() : { categorias: ["FicÃ§Ã£o"], estados: ["Bom"] };
            renderAuxUI();
        }

        window.adicionarAuxCloud = async (tipo) => {
            const inp = document.getElementById(tipo === 'categorias' ? 'input_cat' : 'input_est');
            if(!inp.value) return; 
            if(!auxiliares[tipo]) auxiliares[tipo] = []; 
            auxiliares[tipo].push(inp.value);
            await setDoc(doc(db_cloud, "config", "auxiliares"), auxiliares); 
            inp.value = ''; carregarAuxiliares();
        };

        function renderAuxUI() {
            const u = (arr, lid, sid) => {
                const l = document.getElementById(lid), s = document.getElementById(sid);
                if(!l || !s) return;
                l.innerHTML = ''; s.innerHTML = ''; 
                (arr || []).forEach(it => {
                    l.innerHTML += `<span class="bg-indigo-50 text-indigo-700 px-2 py-1 rounded-lg text-[10px] font-black uppercase border border-indigo-100">${it}</span>`;
                    s.innerHTML += `<option value="${it}">${it}</option>`;
                });
            };
            u(auxiliares.categorias, 'list_cat', 'select_categoria');
            u(auxiliares.estados, 'list_est', 'select_estado');
        }

        function renderizarUI(dados) {
            const c = document.getElementById('lista_acervo'); 
            c.innerHTML = '';
            document.getElementById('contador').innerText = `${dados.length} ITENS`;
            dados.forEach(l => {
                c.innerHTML += `
                    <div class="bg-white p-3 rounded-2xl flex items-center gap-3 border border-slate-100 shadow-sm active:bg-slate-50">
                        <div class="w-12 h-16 bg-slate-100 rounded-lg overflow-hidden flex-shrink-0">
                            ${l.foto ? `<img src="${l.foto}" class="w-full h-full object-cover">` : '<div class="w-full h-full flex items-center justify-center text-xs">ðŸ“š</div>'}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="text-xs font-black truncate text-slate-800">${l.titulo}</h4>
                            <p class="text-[9px] text-slate-400 font-bold uppercase truncate">${l.autor}</p>
                            <div class="mt-1 flex gap-2 items-center">
                                <span class="text-[8px] font-black text-indigo-600 uppercase">${l.sku}</span>
                                <span class="w-1 h-1 bg-slate-200 rounded-full"></span>
                                <span class="text-[8px] font-bold text-slate-400 uppercase">${l.categoria}</span>
                            </div>
                        </div>
                        <div class="flex gap-1">
                            <button onclick="window.editarLivro('${l.id}')" class="p-2 text-indigo-500 bg-indigo-50 rounded-xl">âœŽ</button>
                            <button onclick="window.removerLivro('${l.id}')" class="p-2 text-rose-300">âœ–</button>
                        </div>
                    </div>`;
            });
        }

        window.filtrarAcervoLocal = () => {
            const t = document.getElementById('filtro').value.toLowerCase();
            const f = acervoCache.filter(l => l.titulo.toLowerCase().includes(t) || l.sku.toLowerCase().includes(t));
            renderizarUI(f);
        };
        carregarAuxiliares();
    </script>

    <script>
        function switchTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));
            document.getElementById(id).classList.add('active'); 
            el.classList.add('active-tab');
            window.scrollTo(0,0);
        }
        
        let sc;
        function abrirScanner() {
            document.getElementById('modalScanner').classList.remove('hidden');
            sc = new Html5Qrcode("reader");
            // Ãrea de scan aumentada para cÃ³digos ISBN (retangular e maior)
            sc.start({ facingMode: "environment" }, { 
                fps: 15, 
                qrbox: { width: 300, height: 200 },
                aspectRatio: 1.0 
            }, t => {
                fecharScanner(); 
                document.getElementById('buscaManual').value = t; 
                window.buscarLivro(t);
            });
        }
        
        function fecharScanner() { if(sc) sc.stop(); document.getElementById('modalScanner').classList.add('hidden'); }
        
        async function abrirCameraDireta() {
            document.getElementById('modalCamera').classList.remove('hidden');
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            document.getElementById('videoElement').srcObject = stream; 
            window.cStream = stream;
        }
        
        function fecharCamera() { if(window.cStream) window.cStream.getTracks().forEach(t => t.stop()); document.getElementById('modalCamera').classList.add('hidden'); }
        
        function capturarFoto() {
            const v = document.getElementById('videoElement'), c = document.getElementById('canvasElement');
            c.width = v.videoWidth; c.height = v.videoHeight;
            c.getContext('2d').drawImage(v, 0, 0); 
            window.setCapa(c.toDataURL('image/jpeg', 0.8)); 
            fecharCamera();
        }
    </script>
</body>
</html>
